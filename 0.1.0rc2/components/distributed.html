


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Distributed &mdash; PyTorch/TorchX main documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/torchx.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/katex-math.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/torchx.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Interpret" href="interpret.html" />
    <link rel="prev" title="Train" href="train.html" />
  <!-- Google Analytics -->
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117752657-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-117752657-2');
    </script>
  
  <!-- End Google Analytics -->
  

  
  <script src="../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/elastic/">
                  <span class="dropdown-title">TorchElastic</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorchâ€™s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href='/torchx/versions.html'>v0.1.0rc2 &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configure.html">Configuring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app_best_practices.html">App Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../component_best_practices.html">Component Best Practices</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/hello_world.html">Hello World</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples_apps/index.html">Application Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples_pipelines/index.html">Pipelines Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../specs.html">torchx.specs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runner.html">torchx.runner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedulers.html">torchx.schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipelines.html">torchx.pipelines</a></li>
</ul>
<p class="caption"><span class="caption-text">Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="train.html">Train</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpret.html">Interpret</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="hpo.html">HPO</a></li>
<li class="toctree-l1"><a class="reference internal" href="serve.html">Serve</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
</ul>
<p class="caption"><span class="caption-text">Runtime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../runtime/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runtime/hpo.html">HPO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runtime/tracking.html">Tracking</a></li>
</ul>
<p class="caption"><span class="caption-text">Schedulers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../schedulers/local.html">Localhost</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedulers/kubernetes.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedulers/slurm.html">Slurm</a></li>
</ul>
<p class="caption"><span class="caption-text">Pipeline Adapters</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pipelines/kfp.html">Kubeflow Pipelines</a></li>
</ul>
<p class="caption"><span class="caption-text">Experimental Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../experimental/runner.config.html">(beta) .torchxconfig file</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>Distributed</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="../_sources/components/distributed.rst.txt" rel="nofollow"><img src="../_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
  

  <!-- copied from pytorch_sphinx_theme -->
  
  <div class="rst-content">
  
    <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
     <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
      
  <section id="module-torchx.components.dist">
<span id="distributed"></span><h1>Distributed<a class="headerlink" href="#module-torchx.components.dist" title="Permalink to this headline">Â¶</a></h1>
<p>Torchx helps you to run your distributed trainer jobs. Check out <a class="reference internal" href="train.html#module-torchx.components.train" title="torchx.components.train"><code class="xref py py-mod docutils literal notranslate"><span class="pre">torchx.components.train</span></code></a>
on the example of running single trainer job. Here we will be using
the same <a class="reference internal" href="../examples_apps/lightning_classy_vision/train.html#trainer-app-example"><span class="std std-ref">Trainer App Example</span></a>.
but will run it in a distributed manner.</p>
<p>Torchx uses <a class="reference external" href="https://pytorch.org/docs/stable/elastic/run.html">Torch distributed run</a> to launch user processes
and expects that user applications will be written in
<a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.parallel.DistributedDataParallel.html">Distributed data parallel</a>
manner</p>
<section id="distributed-trainer-execution">
<h2>Distributed Trainer Execution<a class="headerlink" href="#distributed-trainer-execution" title="Permalink to this headline">Â¶</a></h2>
<p>In order to run your trainer on a single or multiple processes, remotely or locally, all you need to do is to
write a distributed torchx component. The example that we will be using here is
<a class="reference internal" href="../examples_apps/lightning_classy_vision/component.html#distributed-trainer-component"><span class="std std-ref">Distributed Trainer Component</span></a></p>
<p>The component defines how the user application is launched and torchx will take care of translating this into
scheduler-specific definitions.</p>
<section id="single-node-multiple-trainers-desktop">
<h3>Single node, multiple trainers (desktop)<a class="headerlink" href="#single-node-multiple-trainers-desktop" title="Permalink to this headline">Â¶</a></h3>
<p>Try launching a single node, multiple trainers example on your desktop:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>torchx run -s local_cwd     ./torchx/examples/apps/lightning_classy_vision/component.py:trainer_dist     --nnodes <span class="m">1</span> --nproc_per_node <span class="m">2</span>     --rdzv_backend c10d --rdzv_endpoint localhost:29500
</pre></div>
</div>
<p>The <cite>./torchx/examples/apps/lightning_classy_vision/component.py:trainer_dist</cite> is reference to the component
function: <a class="reference internal" href="../examples_apps/lightning_classy_vision/component.html#distributed-trainer-component"><span class="std std-ref">Distributed Trainer Component</span></a></p>
</section>
<section id="single-node-multiple-trainers-kubernetes">
<h3>Single node, multiple trainers (kubernetes)<a class="headerlink" href="#single-node-multiple-trainers-kubernetes" title="Permalink to this headline">Â¶</a></h3>
<p>Now lets launch the same component on the kubernetes cluster.
Check out <a class="reference internal" href="../schedulers/kubernetes.html#module-torchx.schedulers.kubernetes_scheduler" title="torchx.schedulers.kubernetes_scheduler"><code class="xref py py-mod docutils literal notranslate"><span class="pre">torchx.schedulers.kubernetes_scheduler</span></code></a> on dependencies that needs to be installed
before running using <cite>kubernetes</cite> scheduler.</p>
<p>We can use the following cmd to launch application on kubernetes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>torchx run -s kubernetes --scheduler_args <span class="nv">namespace</span><span class="o">=</span>default,queue<span class="o">=</span>default     ./torchx/examples/apps/lightning_classy_vision/component.py:trainer_dist     --nnodes <span class="m">1</span> --nproc_per_node <span class="m">2</span>
</pre></div>
</div>
<p>The <cite>namespaces</cite> arg corresponds to the kubernetes namespace that you want to launch.
The <cite>queue</cite> arg is the volcano <a class="reference external" href="https://volcano.sh/en/docs/queue/">queue</a>.</p>
<p>Example of output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubernetes://torchx/default:cv-trainer-pa2a7qgee9zng
torchx <span class="m">2021</span>-10-18 <span class="m">18</span>:46:55 INFO     Launched app: kubernetes://torchx/default:cv-trainer-pa2a7qgee9zng
torchx <span class="m">2021</span>-10-18 <span class="m">18</span>:46:55 INFO     AppStatus:
  msg: &lt;NONE&gt;
  num_restarts: -1
  roles: <span class="o">[]</span>
  state: PENDING <span class="o">(</span><span class="m">2</span><span class="o">)</span>
  structured_error_msg: &lt;NONE&gt;
  ui_url: null

torchx <span class="m">2021</span>-10-18 <span class="m">18</span>:46:55 INFO     Job URL: None
</pre></div>
</div>
<p>You can use the job url to query the status or logs of the job:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>torchx status kubernetes://torchx/default:cv-trainer-pa2a7qgee9zng

torchx <span class="m">2021</span>-10-18 <span class="m">18</span>:47:44 INFO     AppDef:
  State: SUCCEEDED
  Num Restarts: -1
Roles:
 *worker<span class="o">[</span><span class="m">0</span><span class="o">]</span>:SUCCEEDED
</pre></div>
</div>
<p>Try running <cite>torchx log kubernetes://torchx/default:cv-trainer-pa2a7qgee9zng</cite>.</p>
</section>
<section id="multiple-nodes-multiple-trainers-kubernetes">
<h3>Multiple nodes, multiple trainers (kubernetes)<a class="headerlink" href="#multiple-nodes-multiple-trainers-kubernetes" title="Permalink to this headline">Â¶</a></h3>
<p>It is simple to launch multiple nodes trainer in kubernetes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>torchx run -s kubernetes --scheduler_args <span class="nv">namespace</span><span class="o">=</span>default,queue<span class="o">=</span>default     ./torchx/examples/apps/lightning_classy_vision/component.py:trainer_dist     --nnodes <span class="m">2</span> --nproc_per_node <span class="m">2</span>
</pre></div>
</div>
<p>The command above will launch distributed train job on kubernetes <cite>default</cite> namespace using volcano
<cite>default</cite> queue. It will use etcd service accessible on <cite>etcd-server:2379</cite> to perform
<a class="reference external" href="https://pytorch.org/docs/stable/elastic/rendezvous.html">etcd rendezvous</a>.</p>
<p>You can overwrite rendezvous endpoint:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>torchx run -s kubernetes --scheduler_args <span class="nv">namespace</span><span class="o">=</span>default,queue<span class="o">=</span>default     ./torchx/examples/apps/lightning_classy_vision/component.py:trainer_dist     --nnodes <span class="m">2</span> --nproc_per_node <span class="m">1</span>     --rdzv_endpoint etcd-server.default.svc.cluster.local:2379
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For GPU training, keep <cite>nproc_per_node</cite> equal to the amount of GPUs the instace has.</p>
</div>
<p>The command above will launch distributed train job on kubernetes <cite>default</cite> namespace using volcano
<cite>default</cite> queue. It will use etcd service accessible on <cite>etcd-server:2379</cite> to perform
<a class="reference external" href="https://pytorch.org/docs/stable/elastic/rendezvous.html">etcd rendezvous</a>.</p>
</section>
</section>
<section id="builtin-distributed-components">
<h2>Builtin distributed components<a class="headerlink" href="#builtin-distributed-components" title="Permalink to this headline">Â¶</a></h2>
<p>In the examples above we used custom components to launch user applications. It is not always the case that
users need to write their own components.</p>
<p>Torchx comes with set of builtin component that describe typical execution patterns.</p>
<section id="dist-ddp">
<h3>dist.ddp<a class="headerlink" href="#dist-ddp" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">dist.ddp</span></code>  is a component  for applications that run as distributed jobs in a DDP manner.
You can use it to quickly iterate over your application without the need of authoring your own component.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">dist.ddp</span></code> is a generic component, as a result it is good for quick iterations, but not production usage.
It is recommended to author your own component if you want to put your application in production.
Learn more <a class="reference internal" href="overview.html#authoring"><span class="std std-ref">Authoring</span></a> about how to author your component.</p>
</div>
<p>We will be using <code class="docutils literal notranslate"><span class="pre">dist.ddp</span></code> to execute the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># main.py</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.distributed</span> <span class="k">as</span> <span class="nn">dist</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">torch.distributed.run</span>

<span class="k">def</span> <span class="nf">compute_world_size</span><span class="p">():</span>
    <span class="n">rank</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;RANK&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>
    <span class="n">world_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;WORLD_SIZE&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">))</span>
    <span class="n">dist</span><span class="o">.</span><span class="n">init_process_group</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;successfully initialized process group&quot;</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">world_size</span><span class="p">)</span>
    <span class="n">dist</span><span class="o">.</span><span class="n">all_reduce</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">computed_world_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;rank: </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s2">, actual world_size: </span><span class="si">{</span><span class="n">world_size</span><span class="si">}</span><span class="s2">, computed world_size: </span><span class="si">{</span><span class="n">computed_world_size</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">compute_world_size</span><span class="p">()</span>
</pre></div>
</div>
<section id="single-trainer-on-desktop">
<h4>Single trainer on desktop<a class="headerlink" href="#single-trainer-on-desktop" title="Permalink to this headline">Â¶</a></h4>
<p>We can run this example on desktop on four processes using the following cmd:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>torchx run -s local_cwd dist.ddp --entrypoint main.py --nproc_per_node <span class="m">4</span>
</pre></div>
</div>
</section>
<section id="single-trainer-on-kubernetes-cluster">
<h4>Single trainer on kubernetes cluster<a class="headerlink" href="#single-trainer-on-kubernetes-cluster" title="Permalink to this headline">Â¶</a></h4>
<p>We can execute it on the kubernetes cluster</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>torchx run -s kubernetes --scheduler_args <span class="nv">namespace</span><span class="o">=</span>default,queue<span class="o">=</span>defaultdist.ddp --entrypoint main.py --nproc_per_node <span class="m">4</span>
</pre></div>
</div>
<p>Components APIs</p>
</section>
</section>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="torchx.components.dist.ddp">
<span class="sig-prename descclassname"><span class="pre">torchx.components.dist.</span></span><span class="sig-name descname"><span class="pre">ddp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">script_args</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">entrypoint</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'ghcr.io/pytorch/torchx:0.1.0rc2'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rdzv_backend</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rdzv_endpoint</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resource</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nnodes</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nproc_per_node</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><span class="pre">int</span></a></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'test-name'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">role</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'worker'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="../specs.html#torchx.specs.AppDef" title="torchx.specs.api.AppDef"><span class="pre">torchx.specs.api.AppDef</span></a><a class="reference internal" href="../_modules/torchx/components/dist.html#ddp"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#torchx.components.dist.ddp" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Distributed data parallel style application (one role, multi-replica).
Uses <a class="reference external" href="https://pytorch.org/docs/stable/distributed.elastic.html">torch.distributed.run</a>
to launch and coordinate pytorch worker processes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>script_args</strong> â€“ Script arguments.</p></li>
<li><p><strong>image</strong> â€“ container image.</p></li>
<li><p><strong>entrypoint</strong> â€“ script or binary to run within the image.</p></li>
<li><p><strong>rdzv_backend</strong> â€“ rendezvous backend to use, allowed values can be found in the
<a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/torch/distributed/elastic/rendezvous/registry.py">rdzv registry docs</a>
The default backend is <cite>c10d</cite></p></li>
<li><p><strong>rdzv_endpoint</strong> â€“ Controller endpoint. In case of rdzv_backend is etcd, this is a etcd
endpoint, in case of c10d, this is the endpoint of one of the hosts.
The default entdpoint it <cite>localhost:29500</cite></p></li>
<li><p><strong>resource</strong> â€“ Optional named resource identifier. The resource parameter
gets ignored when running on the local scheduler.</p></li>
<li><p><strong>nnodes</strong> â€“ Number of nodes.</p></li>
<li><p><strong>nproc_per_node</strong> â€“ Number of processes per node.</p></li>
<li><p><strong>name</strong> â€“ Name of the application.</p></li>
<li><p><strong>role</strong> â€“ Name of the ddp role.</p></li>
<li><p><strong>env</strong> â€“ Env variables.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Torchx AppDef</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="../specs.html#torchx.specs.AppDef" title="torchx.specs.AppDef">specs.AppDef</a></p>
</dd>
</dl>
</dd></dl>

</section>


     </article>
     
    </div>
    <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="interpret.html" class="btn btn-neutral float-right" title="Interpret" accesskey="n" rel="next">Next <img src="../_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="train.html" class="btn btn-neutral" title="Train" accesskey="p" rel="prev"><img src="../_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, TorchX Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

  </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">Distributed</a><ul>
<li><a class="reference internal" href="#distributed-trainer-execution">Distributed Trainer Execution</a><ul>
<li><a class="reference internal" href="#single-node-multiple-trainers-desktop">Single node, multiple trainers (desktop)</a></li>
<li><a class="reference internal" href="#single-node-multiple-trainers-kubernetes">Single node, multiple trainers (kubernetes)</a></li>
<li><a class="reference internal" href="#multiple-nodes-multiple-trainers-kubernetes">Multiple nodes, multiple trainers (kubernetes)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#builtin-distributed-components">Builtin distributed components</a><ul>
<li><a class="reference internal" href="#dist-ddp">dist.ddp</a><ul>
<li><a class="reference internal" href="#single-trainer-on-desktop">Single trainer on desktop</a></li>
<li><a class="reference internal" href="#single-trainer-on-kubernetes-cluster">Single trainer on kubernetes cluster</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
         <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
         <script src="../_static/jquery.js"></script>
         <script src="../_static/underscore.js"></script>
         <script src="../_static/doctools.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js"></script>
         <script src="../_static/katex_autorenderer.js"></script>
         <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
         <script src="../_static/js/torchx.js"></script>
     

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Stay Connected</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
            <a href="https://www.youtube.com/pytorch" target="_blank" class="youtube"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebookâ€™s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/elastic/">TorchElastic</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>